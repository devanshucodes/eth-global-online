# üóÑÔ∏è Database Setup & Management Guide

## Quick Start

### Initialize Database (First Time)
```bash
node database/setup.js
```

**Expected Output:**
```
Database initialized successfully
```

This creates `database/ai_company.db` with all required tables.

---

## Database Location

- **Path:** `database/ai_company.db`
- **Type:** SQLite3
- **No server needed** - It's a file-based database

---

## Database Tables

The database contains these tables:

1. **ideas** - Business ideas generated by CEO Agent
2. **research** - Market research data from Research Agent
3. **products** - Product concepts from Product Agent
4. **agent_activities** - All agent action logs
5. **votes** - Token holder voting records
6. **bolt_prompts** - Website generation prompts
7. **revenue_distributions** - Revenue tracking
8. **token_holders** - Token holder wallets and balances
9. **project_completions** - Completed projects
10. **ceo_agents** - CEO agent configurations
11. **companies** - Company records
12. **agent_token_holdings** - Token ownership records

---

## Common Commands

### Reset Database (Delete Everything)
```bash
rm database/ai_company.db
node database/setup.js
```

### Inspect Database Contents
```bash
# Run the inspection script
./database/inspect-db.sh
```

### View Specific Table Data
```bash
sqlite3 database/ai_company.db "SELECT * FROM ideas;"
sqlite3 database/ai_company.db "SELECT * FROM agent_activities ORDER BY created_at DESC LIMIT 10;"
sqlite3 database/ai_company.db "SELECT * FROM products WHERE status='approved';"
```

### Count Records
```bash
sqlite3 database/ai_company.db "SELECT COUNT(*) FROM ideas;"
sqlite3 database/ai_company.db "SELECT COUNT(*) FROM agent_activities;"
```

### Interactive Mode
```bash
# Open SQLite shell
sqlite3 database/ai_company.db

# Inside the shell:
.tables                    # List all tables
.schema ideas              # Show table structure
SELECT * FROM ideas;       # Query data
.exit                      # Exit
```

---

## Useful SQLite Commands

### Inside `sqlite3` shell:

```sql
-- View all tables
.tables

-- View table structure
.schema ideas

-- Pretty output
.mode column
.headers on

-- Export data to CSV
.mode csv
.output ideas.csv
SELECT * FROM ideas;
.output stdout

-- View recent activities
SELECT * FROM agent_activities ORDER BY created_at DESC LIMIT 20;

-- View approved ideas
SELECT id, title, status FROM ideas WHERE status='approved';

-- View all votes
SELECT * FROM votes ORDER BY created_at DESC;
```

---

## Database Workflow

### What Happens When You Run the App:

1. **Backend starts** ‚Üí Connects to `database/ai_company.db`
2. **User clicks "Generate Idea"** ‚Üí CEO Agent creates record in `ideas` table
3. **Activity logged** ‚Üí Entry added to `agent_activities` table
4. **User approves idea** ‚Üí Status updated, vote recorded in `votes` table
5. **Research runs** ‚Üí Data stored in `research` table
6. **Product created** ‚Üí Entry added to `products` table
7. **Revenue distributed** ‚Üí Records in `revenue_distributions` table

---

## Troubleshooting

### Database Not Found
```bash
# Create it:
node database/setup.js
```

### Database Locked Error
```bash
# Kill any processes using it:
pkill -f "node server.js"
pkill -f sqlite3

# Then restart:
PORT=5001 npm start
```

### Corrupt Database
```bash
# Backup old database
mv database/ai_company.db database/ai_company.db.backup

# Create fresh database
node database/setup.js
```

### View Database Location
```bash
# Check where database is stored
ls -lh database/ai_company.db

# Check file size
du -h database/ai_company.db
```

---

## Database Backup

### Manual Backup
```bash
# Backup database
cp database/ai_company.db database/ai_company.db.backup

# Restore from backup
cp database/ai_company.db.backup database/ai_company.db
```

### Automated Backup Script
```bash
# Create backup with timestamp
cp database/ai_company.db "database/backups/ai_company_$(date +%Y%m%d_%H%M%S).db"
```

---

## Environment Variables

You can customize the database path in `.env`:

```bash
DB_PATH=./database/ai_company.db
```

---

## Database Schema Reference

### Ideas Table
```sql
CREATE TABLE ideas (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT NOT NULL,
  description TEXT,
  potential_revenue TEXT,
  status TEXT DEFAULT 'pending',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### Agent Activities Table
```sql
CREATE TABLE agent_activities (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  agent_name TEXT,
  activity TEXT,
  data TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

---

## Quick Reference

| Command | Purpose |
|---------|---------|
| `node database/setup.js` | Initialize/verify database |
| `./database/inspect-db.sh` | Quick database overview |
| `sqlite3 database/ai_company.db` | Open interactive shell |
| `rm database/ai_company.db` | Delete database |
| `.tables` | List all tables (in sqlite3) |
| `.schema TABLE_NAME` | Show table structure (in sqlite3) |

---

## Need More Help?

- Check `database/setup.js` for complete schema
- View `server.js` for database connection code
- Check `routes/*.js` for database queries

---

**The database is automatically created and managed - you just need to run `node database/setup.js` once!**
